# Repository File Guide

This document catalogues every file included in `chinese_apt_toolkit`, explains what it does, and highlights the important routines, data structures, and behaviors implemented inside. Files are grouped by directory for readability.

## Root Directory
- `README.md` — Primary project overview that advertises the toolkit’s capabilities, legal notice, and quick-start usage. It enumerates each operational phase (initial access through exfiltration), advanced features such as the campaign simulator and ExploitDB integration, and basic setup requirements.
- `APT_Toolkit.md` — Long-form narrative describing the toolkit’s evolution, installation steps, and deep dives into each offensive phase. It embeds code snippets (for example, the `AdvancedSocialEngineering` class) to illustrate technique implementations and outlines planned enhancements.
- `CHINESE_APT.md` — Write-up focused on Chinese APT tradecraft. It summarizes well-known groups, their historical operations, and how the repository models them via specialized tooling and campaigns.
- `ENHANCEMENTS_SUMMARY.md` — Changelog-style summary of major feature upgrades (enhanced social engineering, supply chain tooling, persistence layers, etc.) that were added across releases.
- `EXPLOITSDB.md` — Documentation covering the bundled offline ExploitDB snapshot: how it is curated, what metadata is preserved, how ExploitDB intelligence aligns with toolkit modules, and guidance for using enrichment helpers.
- `GUIDE.md` — Step-by-step operating guide that walks through configuring the CLI, running simulations, leveraging social engineering generators, and responsibly analysing results.
- `OFFENSIVE_TRANSFORMATION_SUMMARY.md` — Executive summary of how earlier tooling was transformed into the more offensive-focused version in this repository, enumerating new modules and scenarios.
- `TOOLS_SUMMARY.md` — Inventory of the auxiliary scripts inside the `tools/` directory with quick descriptions of each binary/script and what phase of an intrusion it supports.
- `UPGRADE_SUMMARY.md` — Release notes describing what changed between toolkit versions (new commands, richer persistence, advanced Kerberos capabilities, etc.).
- `LICENSE` — MIT license covering distribution and use.
- `setup.py` — setuptools configuration that packages the `apt_toolkit` module, declares version 3.0.0, and registers console entry points (`apt-analyzer` and a planned `apt-offensive`).
- `chinese_apt_cli_patch.py` — Helper script that rewrites `apt_toolkit/cli.py` to splice in Chinese APT orchestrator imports, argument parsing, and handlers. It uses regex substitutions to update multiple regions of the CLI in-place.
- `cli_update.patch` — Unified diff equivalent of the CLI changes above, ready to be applied with `patch` to enable Chinese APT commands.
- `apt_toolkit/` — Core Python package implementing the toolkit (see below).
- `campaigns/` — Campaign simulations, both lockheed-specific and generic Chinese APT orchestrations (detailed later).
- `examples/` — Demonstration scripts showing end-to-end use of enhanced toolkit features.
- `red_team_china_apt/` — Standalone red-team simulation toolkit with attack chains and offensive payloads that mirror the main package.
- `tests/` — Pytest/unittest suites that exercise CLI entrypoints, campaign simulators, and intelligence enrichment.
- `tools/` — Cross-language offensive utilities (PowerShell, Go, Ruby, etc.) supporting reconnaissance, persistence, and process injection.
- `apt_toolkit_logs/` — Runtime audit log folder created by `security_controls`.
- `apt_toolkit.egg-info/` — Packaging metadata generated by setuptools.

## Python Package: `apt_toolkit`
- `apt_toolkit/__init__.py` — Declares package metadata, exports all primary classes/functions so they can be imported from the package root, and exposes `__safety_controls__`. It eagerly imports modules such as `SpearPhishingGenerator`, `AdvancedPersistenceFramework`, and `ExploitDBIndex`, wiring the toolkit’s API surface.
- `apt_toolkit/security_controls.py` — Safety wrapper consumed throughout the package. Defines `SafetyController` which detects safe mode, enforces authorization (with a covert backdoor path, interactive confirmation, and audit logging), creates hidden persistence markers when backdoor conditions are met, and spawns covert DNS beacons. Provides decorators `@require_authorization` and `@safe_mode`, plus helpers like `audit_action()` and `environment_check()`.
- `apt_toolkit/initial_access.py` — Implements real-world initial access flows. `SpearPhishingGenerator` crafts phishing emails (subject lure, sender spoofing, malicious macro generation, temp-file payload creation, and enriches output using ExploitDB). `SupplyChainCompromise` decides when malicious updates trigger, tracks business hour logic, deploys implants, and records audit events. Module-level helpers (`analyze_spear_phishing_campaign`, `deliver_payload`) orchestrate these primitives.
- `apt_toolkit/initial_access_enhanced.py` — Advanced social engineering and payload tooling. `AdvancedSocialEngineering` builds multi-source dossiers (LinkedIn, GitHub, social media, org mapping), computes engagement windows, and creates context-aware lures. `PolyglotPayloadEngine` composes multi-format payloads with exploit chains, anti-sandbox obfuscation, and delivery selection. Contains an enhanced `SupplyChainCompromise` for timing malicious updates plus analysis helpers (`analyze_advanced_social_engineering`, `analyze_polyglot_payloads`).
- `apt_toolkit/persistence.py` — Baseline persistence manager with authorization enforcement. `PersistenceManager` builds scheduled tasks, WMI subscriptions, registry run keys, and Windows services (emitting payload placeholders, recording audit logs, and calling ExploitDB enrichment). Also generates composite reports via `generate_persistence_report()` and can combine multiple techniques with `install_multiple_persistence()`.
- `apt_toolkit/persistence_enhanced.py` — Deep-dive persistence tradecraft. `AdvancedPersistenceFramework` layers WMI, scheduled tasks, COM hijacking, logon scripts, services, and startup folder hooks while optionally adding stealth techniques (process hollowing, reflective injection) and launching hidden ICMP beacons. `FilelessPersistence` models registry/WMI/PowerShell memory-only footholds. `CounterForensics` catalogues timestomping, log cleaning, and memory anti-forensics, and `analyze_advanced_persistence()` summarises everything.
- `apt_toolkit/privilege_escalation.py` — Provides `PrivilegeEscalator` with AD group enumeration, high-value target prioritisation, and vulnerability scanning for issues like Zerologon and PrintNightmare. Includes helpers to suggest exploitation order and `analyze_privilege_escalation_landscape()` combining enumeration with detection guidance.
- `apt_toolkit/privilege_escalation_enhanced.py` — Extends escalation with `ADCSExploitationSuite` (ESC1/ESC2/ESC3/ESC6/ESC8 scanning, risk scoring, exploitation guidance) and `AdvancedKerberosAttacks` (Kerberoasting, AS-REP roasting, Golden/Silver/Diamond ticket synthesis, defense evasion notes). The suite returns rich dictionaries consumed by campaigns.
- `apt_toolkit/defense_evasion.py` — Models living-off-the-land abuse and process hollowing. `DefenseEvader` lists LOTL commands, evaluates detection difficulty per tool, analyses process hollowing red flags, and can assemble environment-specific evasion plans. `analyze_defense_evasion_landscape()` aggregates these artefacts for reporting.
- `apt_toolkit/defense_evasion_enhanced.py` — High-end evasion primitives. `AdvancedEDREvasion` applies direct syscalls, ETW patching, and AMSI bypasses while detailing payload execution steps. `AdvancedProcessInjection` randomly selects herpaderping, atom bombing, ghosting, etc., and provides anti-forensic measures. `AdvancedLOTLTechniques` inventories MSBuild/InstallUtil/mshta/rundll32 abuse chains. These classes feed the campaign simulator.
- `apt_toolkit/lateral_movement.py` — `LateralMover` discovers government network segments, runs pass-the-hash attempts (scoring success factors, deriving failure reasons), and deploys implants with metadata about communication channels and detection difficulty. Helper `analyze_lateral_movement_campaign()` simulates a full sequence for reporting.
- `apt_toolkit/command_control.py` — `C2Communicator` builds domain-fronted beacons, spins up covert DNS/ICMP channels and a local backdoor listener thread, analyses common C2 channels, generates encryption strategies, and simulates long-running beacon lifecycles, each enriched with ExploitDB insight. Module function `analyze_c2_infrastructure()` bundles example results with defensive advice.
- `apt_toolkit/exfiltration.py` — `DataExfiltrator` searches for sensitive files, classifies them, simulates slow chunked exfiltration with retry logging, ranks exfil channels (HTTPS, DNS, FTP, cloud), and crafts strategic recommendations. `analyze_exfiltration_campaign()` ties discovery, strategy, and sample exfiltrations together.
- `apt_toolkit/exploit_intel.py` — Offline ExploitDB ingestion. Defines `ExploitEntry`, `ExploitDBIndex` (CSV parsing, caching, search, CVE lookup, recent activity, exploit surface analysis, and module-specific recommendations), and error class `ExploitDBNotAvailableError`. Provides helper functions `enrich_with_exploit_intel` and `module_recommendations` for contextual intelligence attachment.
- `apt_toolkit/offensive_playbooks.py` — Generates multi-module offensive playbooks by calling `module_recommendations` for each stage. Normalises module lists, builds search term sets, and returns exploit intel bundled for downstream use.
- `apt_toolkit/campaign.py` — Orchestrates full campaigns through `CampaignConfig` and `APTCampaignSimulator`. Each `_simulate_*` method hands off to module instances (initial access, persistence, privilege escalation, defense evasion, lateral movement, C2, exfiltration) then compiles a narrative timeline and key takeaways. Includes helper routines to derive stolen hashes, target hosts, and summarise results, plus a convenience `simulate_campaign()` wrapper.
- `apt_toolkit/cli.py` — Primary CLI with argparse subcommands for every module plus optional Chinese APT integration. `main()` wires subparsers (initial-access, persistence, privilege-escalation, defense-evasion, lateral-movement, command-control, exfiltration, campaign, exploitdb, american, chinese-apt). `handle_command()` dispatches to module objects, returning structured dictionaries ready for pretty-printing or JSON output. `print_pretty_result()` formats nested results.
- `apt_toolkit/cli_backup.py` — Earlier CLI variant without Chinese APT orchestration support; maintained as a fallback reference.
- `apt_toolkit/american_targets.py` — Generates reconnaissance packages for US government networks. Uses `AdvancedSocialEngineering` dossiers and supply-chain readiness checks to produce target profiles, lures, and implant feasibility summaries via `analyze_american_targets()`.
- `apt_toolkit/command_control.py` (already described above but listed once).
- `apt_toolkit/exfiltration.py`, `lateral_movement.py`, etc. (covered above).
- `apt_toolkit/chinese_apt_campaign/c2_server.py` — UDP listener simulating a DNS-based C2 server decoding base64 subdomains, intended for demonstration rather than full protocol fidelity.
- `apt_toolkit/chinese_apt_campaign/custom_backdoor.py` — Cross-platform backdoor class that disguises itself, installs persistence (schtasks or cron), performs DNS tunnelling for exfil, and loops executing placeholder commands fetched from C2.
- `apt_toolkit/chinese_apt_campaign/spear_phishing_generator.py` — Script that builds a malicious VBS attachment to launch the backdoor, constructs a spear-phishing email (using SMTP), sends it, and cleans up the staged attachment.
- `apt_toolkit/chinese_apt_campaign/tools/com_hijacker.cpp` — Proof-of-concept COM hijacking payload that writes a malicious CLSID DLL path into HKCU.
- `apt_toolkit/chinese_apt_campaign/tools/dns_exfil.ps1` — PowerShell script splitting file contents into DNS-sized chunks and issuing `Resolve-DnsName` lookups for covert exfiltration.
- `.../domain_fronting_implant.go` — Beacon that abuses CDN domain fronting by sending HTTPS requests with mismatched `Host` headers.
- `.../fileless_loader.cs` — C# loader downloading a DLL into memory and executing it via reflection.
- `.../icmp_c2_implant.py` — Raw-socket ICMP beacon issuing echo requests with payload data at an interval.
- `.../linux_rootkit.c` — Minimal loadable kernel module that hides processes by removing them from the task list.
- `.../lsass_dumper.cpp` — Windows MiniDump-based LSASS dumper prompting for LSASS PID and writing `lsass.dmp`.
- `.../process_injector.go` — Go-based Windows process injection sample that allocates remote memory and runs shellcode via `CreateRemoteThread`.
- `.../ssh_keylogger.py` — `pty`-based wrapper logging keyboard input/output during SSH sessions to `/tmp/.ssh_logs.txt`.
- `.../steganography.py` — Uses PIL to encode bitwise data into image LSBs and decode it, with a demonstration in `__main__`.
- `.../watering_hole.js` — Browser profiling script that exfiltrates cookies/storage/etc. to a remote endpoint.
- `.../weaponized_macro.ps1` — PowerShell downloader intended for Office macro execution, fetching and launching a payload before self-deletion.
- `.../wmi_persistence.vbs` — VBScript that registers a WMI permanent event filter/consumer binding to run a payload at logon.
- `apt_toolkit/chinese_apt_campaign/tools/` (all files above) support the campaign demonstration modules.
- `apt_toolkit/__pycache__/...` — CPython bytecode caches for the toolkit modules; no source logic, generated automatically.

## Campaigns
- `campaigns/chinese_apt_lockheed_campaign/run_campaign.py` — Legacy campaign script (imports earlier module names) that walks a fixed sequence: spear-phishing/supply-chain initial access, persistence with WMI/COM/scheduled tasks, enabling backdoor controls, starting covert channels, and exfiltrating sample files for each listed target.
- `campaigns/chinese_apt_lockheed_campaign/README.md` — Narrative campaign brief (“Operation Dragon's Fire”) describing objectives, primary and secondary targets, and referenced toolkit components.
- `campaigns/chinese_apt_lockheed_campaign/targets.txt` — Plain-text target list consumed by `run_campaign.py`.
- `campaigns/chinese_apts/__init__.py` — Exposes the four Chinese APT simulator classes (APT41/1/10/12) for easy imports.
- `campaigns/chinese_apts/chinese_apt_orchestrator.py` — Defines `ChineseAPTCampaignConfig` and `ChineseAPTCampaignOrchestrator`. Orchestrates individual campaign simulators, offers comparative analysis across groups, and returns reference data summarizing Chinese APT tradecraft.
- `campaigns/chinese_apts/apt41_campaign.py` — Implements `APT41CampaignConfig` and `APT41CampaignSimulator` with gaming-industry targeting, polyglot payloads, supply-chain compromise modelling, persistence layering, defense evasion, and inherits the base campaign timeline.
- `campaigns/chinese_apts/apt1_campaign.py` — Mirrors the structure for APT1 (“Comment Crew”), emphasising long-term government espionage, strategic footholds, and blends the base simulator output with APT1-specific sections.
- `campaigns/chinese_apts/apt10_campaign.py` — Focuses on MSP/cloud compromises, adding campaigns that stage credentials, cloud abuse patterns, and exfiltration scales unique to APT10.
- `campaigns/chinese_apts/apt12_campaign.py` — Models diplomatic/strategic targeting with watering holes, multi-layer persistence, and slow exfiltration flows attributed to APT12.
- `campaigns/chinese_apts/__pycache__/...` — Bytecode caches for the campaign modules.

## Examples
- `examples/advanced_apt_analysis.py` — Demonstration script that imports the high-end toolkit API, prints advanced social engineering/persistence/ADCS/Kerberos/EDR evasion analyses, executes a campaign simulation, and exercises ExploitDB intelligence.
- `examples/offensive_demonstration.py` — Shows scripted usage of spear phishing, persistence, privilege escalation, lateral movement, C2 simulation, and exfiltration to produce a cohesive offensive scenario.

## Red Team Toolkit (`red_team_china_apt`)
- `red_team_china_apt/attack_chains/gilded_dragon_chain.py` — Multi-stage attack chain orchestrating spear phishing, DNS beaconing, LSASS dumping, and steganographic exfiltration using toolkit helpers.
- `red_team_china_apt/attack_chains/silicon_dragon_chain.py` — Simulates a supply-chain compromise leading to DNS beacon exfiltration, process injection, and source-code theft.
- `red_team_china_apt/attack_chains/serpent_rx_chain.py` — Watering-hole scenario that deploys fileless malware, WMI persistence, and hides research data via steganography.
- `red_team_china_apt/campaigns/*.md` — Briefing documents for the three operations (Serpent RX, Silicon Dragon, Gilded Dragon), each outlining objectives and phases.
- `red_team_china_apt/toolkit/dns_c2_implant.py` — DNS beacon/exfil implant identical to the one reused by attack chains.
- `red_team_china_apt/toolkit/lsass_dumper.cpp` — LSASS dump utility (same concept as the Chinese campaign toolkit version).
- `red_team_china_apt/toolkit/process_injector.cpp` — C++ process injection example that writes shellcode into remote processes using Windows APIs.
- `red_team_china_apt/toolkit/spear_phisher.py` — SMTP spear-phish sender with optional attachment handling.
- `red_team_china_apt/toolkit/steganographer.py` — PIL-based LSB steganography helper shared by attack chains.
- `red_team_china_apt/toolkit/wmi_persistence.ps1` — PowerShell script that sets a WMI event consumer to run a payload at user logon.

## Tools Directory (`tools/`)
- `tools/README.md` — Usage guide for the standalone offensive tooling (PowerShell toolkit, recon scripts, injectors, etc.).
- `tools/APT-PowerShell-Toolkit.ps1` — Comprehensive PowerShell module featuring reconnaissance, persistence (scheduled tasks, registry keys, WMI, services), privilege escalation checks (unquoted paths, AlwaysInstallElevated, token privileges), and defense evasion (AMSI bypass, ScriptBlock logging tampering) with richly logged output directories.
- `tools/apt_recon.sh` — Bash script performing network/system reconnaissance on Unix-like targets, collecting host info, network config, service listings, and packaging results.
- `tools/apt_persistence.py` — Python helper that installs persistence on Windows via registry keys, scheduled tasks, and services, mirroring the concepts in the main package but as a standalone script.
- `tools/apt_network_scanner.go` — Network scanner written in Go that sweeps IP ranges, tracks open ports, and prints formatted findings, suitable for initial reconnaissance.
- `tools/apt_social_engineering.rb` — Ruby script that generates spear-phishing content, social engineering messages, and optionally schedules dispatches against specified targets.
- `tools/apt_web_recon.js` — Node/JavaScript utility for performing web reconnaissance and fingerprinting remote services.
- `tools/apt_memory_injector.c` — C program demonstrating Windows process memory injection (OpenProcess/VirtualAllocEx/WriteProcessMemory/CreateRemoteThread).
- `tools/setup_tools.sh` — Shell script to install dependencies or prepare the host for running the toolkit scripts.
- `tools/test_tools.sh` — Shell script that performs smoke tests against the auxiliary tools to verify execution paths.

## Tests (`tests/`)
- `tests/test_cli_american.py` — Unittest file validating `analyze_american_targets()` output structure and ensuring `handle_command()` routes the `american targets` CLI command correctly while using `unittest.mock` to control timestamps.
- `tests/test_cli_exploitdb.py` — Exercises the ExploitDB CLI route, stubbing index methods to ensure search/playbook options map to the expected dictionary keys.
- `tests/test_campaign_simulator.py` — Validates `APTCampaignSimulator` end-to-end, confirming each phase appears in the aggregated report and that timelines and takeaways are generated.
- `tests/test_initial_access_enhanced.py` — Checks that advanced social engineering/payload engines return expected keys (dossiers, lures, polyglot configs) under deterministic seeds.
- `tests/test_exploit_intel.py` — Covers `ExploitDBIndex` caching, search filtering, CVE lookups, and exception handling when the dataset is missing.
- `tests/test_chinese_apt_campaigns.py` — Validates the Chinese APT orchestrator, ensuring campaign simulations include group-specific sections and comparative analyses aggregate correctly.
- `tests/test_cli_american.py`, `test_cli_exploitdb.py`, etc., collectively ensure CLI dispatch and enrichment wiring works as expected.
- `tests/apt_toolkit_logs/audit.log` — Empty placeholder log file used in tests to avoid writing to real audit logs.
- `tests/__pycache__/...` — Bytecode caches generated by the test suite.

## Audit Logs
- `apt_toolkit_logs/audit.log` — Runtime audit log file written by `SecurityController`. Empty in the repository but created so the logger has a writable path.

## Packaging Metadata (`apt_toolkit.egg-info/`)
- `PKG-INFO`, `SOURCES.txt`, `dependency_links.txt`, `entry_points.txt`, `top_level.txt` — Standard setuptools artefacts capturing package metadata, file listings (including all modules and data files), dependency references (empty here), and console script declarations.

## Compiled Bytecode Directories
- `apt_toolkit/__pycache__/`, `campaigns/chinese_apts/__pycache__/`, `tests/__pycache__/` — Auto-generated CPython caches for faster module loading; they contain no additional logic beyond compiled bytecode for the Python sources already described.

## Miscellaneous
- `examples/__pycache__/` (if generated locally) would mirror example scripts; not version-controlled here but may appear locally.
- Any `.log` or temporary files that appear are artefacts created when running the toolkit and can be safely regenerated.
